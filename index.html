<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>QC Review Dashboard</title>
  <link rel="icon" href="https://spyne-prod-ai.s3.us-east-1.amazonaws.com/ai-dataset/2025/favicon.ico" type="image/x-icon" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f7fa;
      color: #333;
    }

    header {
      background: #0057a3;
      color: white;
      padding: 20px 0;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .container {
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      padding: 20px;
      gap: 20px;
    }

    .image-box {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .image-box img {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .meta {
      font-size: 0.95em;
      color: #666;
    }

    .controls {
      margin: 30px auto;
      text-align: center;
    }

    .status-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .status-group label {
      font-size: 1rem;
      background: #e9f0f7;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .status-group input[type="radio"] {
      margin-right: 8px;
    }

    .status-group label:hover {
      background: #d0e5f5;
    }

    button {
      padding: 12px 25px;
      font-size: 1rem;
      background-color: #0073e6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #005bb5;
    }

    .progress {
      text-align: center;
      margin-top: 15px;
      font-size: 1.1rem;
      color: #444;
    }

    iframe {
      display: none;
    }
  </style>
</head>
<body>

<header>
  <h1>Image QC Review Dashboard</h1>
</header>

<div class="progress" id="progressText">Loading data, please wait...</div>

<div class="container">
  <div class="image-box">
    <h3>Input Image</h3>
    <img id="inputImg" loading="lazy" alt="Input Image">
    <div class="meta">Image ID: <span id="imgId">-</span></div>
  </div>
  <div class="image-box">
    <h3>Output Image</h3>
    <img id="outputImg" loading="lazy" alt="Output Image">
    <div class="meta">SKU ID: <span id="skuId">-</span></div>
  </div>
</div>

<div class="controls">
  <div class="status-group">
    <label><input type="radio" name="status" value="Done"> Done (1 / D)</label>
    <label><input type="radio" name="status" value="Rejected"> Rejected (2 / R)</label>
    <label><input type="radio" name="status" value="Editing"> Editing (3 / E)</label>
  </div>
  <button onclick="submitForm()">Next (Enter)</button>
</div>

<iframe id="hiddenSubmitFrame" name="hiddenSubmitFrame"></iframe>

<script>
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQc6Bd5VEE067t02ubbCE_rAYzgOEN9ggvB8uH28TQKldJ5qGePkdSQeYbdvpbhl3lwb1yIhAr8685B/pub?gid=0&single=true&output=csv";
  let data = [];
  let currentIndex = 0;

  Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(results) {
      data = results.data.filter(row => {
        const status = (row.status || '').trim().toLowerCase();
        return !["done", "rejected", "editing"].includes(status);
      });
      showImage();
      preloadNextImages();
    }
  });

  function showImage() {
    if (currentIndex >= data.length) {
      document.getElementById("progressText").innerText = "âœ… Review complete!";
      return;
    }
    const row = data[currentIndex];
    document.getElementById("inputImg").src = row["input_image_hres_url"];
    document.getElementById("outputImg").src = row["output_image_hres_url"];
    document.getElementById("imgId").innerText = row["image_id"];
    document.getElementById("skuId").innerText = row["sku_id"];
    document.getElementById("progressText").innerText = `Reviewed ${currentIndex + 1} of ${data.length}`;
    preloadNextImages();
  }

  function submitForm() {
    const status = document.querySelector('input[name="status"]:checked');
    if (!status) return alert("Please select a status.");

    const row = data[currentIndex];
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = 'https://docs.google.com/forms/d/e/1FAIpQLSfAcGmJXwfrNV1xLUHNEYGRw7I4ErTNH5n6GhUltxDcAH008w/formResponse';
    form.target = 'hiddenSubmitFrame';

    const imageField = document.createElement('input');
    imageField.type = 'hidden';
    imageField.name = 'entry.331138758';
    imageField.value = row["image_id"];
    form.appendChild(imageField);

    const skuField = document.createElement('input');
    skuField.type = 'hidden';
    skuField.name = 'entry.921407097';
    skuField.value = row["sku_id"];
    form.appendChild(skuField);

    const statusField = document.createElement('input');
    statusField.type = 'hidden';
    statusField.name = 'entry.2036611691';
    statusField.value = status.value;
    form.appendChild(statusField);

    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);

    currentIndex++;
    showImage();
    document.querySelectorAll('input[name="status"]').forEach(el => el.checked = false);
  }

  function preloadNextImages() {
    for (let i = 1; i <= 3; i++) {
      if (currentIndex + i < data.length) {
        const nextRow = data[currentIndex + i];
        const preloadInput = new Image();
        const preloadOutput = new Image();
        preloadInput.src = nextRow["input_image_hres_url"];
        preloadOutput.src = nextRow["output_image_hres_url"];
      }
    }
  }
</script>

</body>
</html>
